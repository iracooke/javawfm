JAVA_LIBS=@JAVA_LIBS@
JAVA_CPPFLAGS=@JAVA_CPPFLAGS@
JAVA_HOME=@JAVA_HOME@
JAVA=@JAVA@
JAVAC=@JAVAC@
JAVAH=@JAVAH@

# Directory with COIN header files
COININCDIR = depends/coin-Cbc/include

# Directory with COIN libraries
COINLIBDIR = ./depends/coin-Cbc/lib/

PKG_CPPFLAGS+=-Iinclude @JAVA_CPPFLAGS@ -I$(COININCDIR)
CXX=@CXX@


# Directory with COIN header files
COININCDIR = depends/coin-Cbc/include

# Directory with COIN libraries
COINLIBDIR = depends/coin-Cbc/lib/

PKG_CXXFLAGS=-fPIC -g -O2 -Iinclude -I/System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Home/include -I$(COININCDIR)

RINSTDIR=../inst/
#JNIINSTDIR=$(RINSTDIR)/jnilibs
JNIINSTDIR=$(RINSTDIR)/libs/i386

JARDIR = $(RINSTDIR)/java
OBJECTS = 

JNIINSTDIR=$(JARDIR)

PKG_LIBS=-L$(COINLIBDIR) -lCbc -lCgl -lOsiClp -lOsiCbc -lOsi -lClp -lCoinUtils -llapack -lm -lblas

#-lRlapack -L/Library/Frameworks/R.framework/Resources/lib/i386 -lRblas -lgfortran -F/Library/Frameworks/R.framework/.. -framework R 

SUBDIRS = depends/coin-Cbc/


#g++ -arch i386 -dynamiclib -Wl,-headerpad_max_install_names -mmacosx-version-min=10.4 -undefined dynamic_lookup -single_module -multiply_defined suppress -L/usr/local/lib -o Rsymphony.so R_symphony.o -LSYMPHONY/lib -lSym -lCgl -lOsiClp -lClp -lOsi -lCoinUtils -L/Library/Frameworks/R.framework/Resources/lib/i386 -lRlapack -L/Library/Frameworks/R.framework/Resources/lib/i386 -lRblas -lgfortran -F/Library/Frameworks/R.framework/.. -framework R -Wl,-framework -Wl,CoreFoundation


FARMLP_LIB=@JNIPREFIX@farmLP@JNISO@

.PHONY: all subdirs javajar

all: $(SHLIB) jnilib 
	
jnilib: javajar farmlib subdirs CBCPeer.o CBC.o jfm_lp_CBCPeer.h
	

javajar:
	ant -buildfile java/build.xml install
	

farmlib:	subdirs CBCPeer.o CBC.o jfm_lp_CBCPeer.h
	$(CXX) -O2 -fPIC -dynamiclib  $(JAVA_LIBS) $(JAVA_CPPFLAGS) -o $(FARMLP_LIB) $(PKG_LIBS)  CBCPeer.o CBC.o
	mkdir -p $(JNIINSTDIR)
	cp $(FARMLP_LIB) $(JNIINSTDIR)
	


jfm_lp_CBCPeer.h	:	./java/src/jfm/lp/CBCPeer.java javajar
	javah -jni -classpath $(JARDIR)/javawfm.jar jfm.lp.CBCPeer
	


CBCPeer.o: CBCPeer.cpp jfm_lp_CBCPeer.h subdirs
	$(CXX)  -c $< $(PKG_CXXFLAGS)
	

CBC.o: CBC.cpp jfm_lp_CBCPeer.h subdirs
	$(CXX) -c $< $(PKG_CXXFLAGS)

subdirs:
	$(MAKE) install -C $(SUBDIRS)

clean:
	$(MAKE) clean -C $(SUBDIRS)
	
	