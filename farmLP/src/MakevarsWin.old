JAVA_LIBS=@JAVA_LIBS@
JAVA_CPPFLAGS=@JAVA_CPPFLAGS@
JAVA_HOME=@JAVA_HOME@
JAVA=@JAVA@
JAVAC=@JAVAC@
JAVAH=@JAVAH@

# Directory with COIN header files
COININCDIR = depends/coin-Cbc/include

# Directory with COIN libraries
COINLIBDIR = ./depends/coin-Cbc/lib/

PKG_CPPFLAGS+=-Iinclude @JAVA_CPPFLAGS@ -I$(COININCDIR)
CXX=@CXX@

GLPKINCDIR=@GLPKINSTDIR@/include

GLPKLIBDIR=@GLPKINSTDIR@/lib

# Directory with COIN header files
COININCDIR = depends/coin-Cbc/include

# Directory with COIN libraries
COINLIBDIR = depends/coin-Cbc/lib/

PKG_CXXFLAGS=-Iinclude -I/System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Home/include -I$(COININCDIR) -I$(GLPKINCDIR)

RINSTDIR=../inst/


JARDIR = $(RINSTDIR)/java
JNIINSTDIR=$(JARDIR)/@ARCHFLAG@/

OBJECTS = CBCPeer.o CBC.o GLPK.o GLPKPeer.o

PKG_LIBS=-L$(COINLIBDIR) -L$(GLPKLIBDIR) -lglpk -lCbc -lCgl -lOsiClp -lOsiCbc -lOsi -lClp -lCoinUtils 

SUBDIRSCBC = depends/coin-Cbc/
SUBDIRSGLPK = depends/glpk-4.39/

SHLIB_EXT=.jnilib
SHLIB_LIBADD=lib
SHLIB=libfarmLP.jnilib
FARMLP_LIB=@JNIPREFIX@farmLP@JNISO@

.PHONY: all subdirs javajar

all: $(SHLIB)
$(SHLIB): javajar subdirs CBCPeer.o CBC.o jfm_lp_CBCPeer.h GLPKPeer.o GLPK.o jfm_lp_GLPKPeer.h
	

javajar:
	echo $(SHLIB)
	echo $(R_LIBRARY_DIR)
	ant -buildfile java/build.xml install
	

	
jfm_lp_CBCPeer.h	:	./java/src/jfm/lp/CBCPeer.java javajar 
	javah -jni -classpath $(JARDIR)/javawfm.jar jfm.lp.CBCPeer
	

jfm_lp_GLPKPeer.h: ./java/src/jfm/lp/GLPKPeer.java javajar 
	javah -jni -classpath $(JARDIR)/javawfm.jar jfm.lp.GLPKPeer

GLPK.o: GLPK.cpp jfm_lp_GLPKPeer.h subdirs
	$(CXX) -c $< $(PKG_CXXFLAGS)
	
GLPKPeer.o: GLPKPeer.cpp jfm_lp_GLPKPeer.h subdirs
	$(CXX) -c $< $(PKG_CXXFLAGS)

CBCPeer.o: CBCPeer.cpp jfm_lp_CBCPeer.h subdirs
	$(CXX) -c $< $(PKG_CXXFLAGS)
	
CBC.o: CBC.cpp jfm_lp_CBCPeer.h subdirs
	$(CXX) -c $< $(PKG_CXXFLAGS)

subdirs:
	mkdir -p @GLPKINSTDIR@
	$(MAKE) install -C $(SUBDIRSGLPK)
	$(MAKE) install -C $(SUBDIRSCBC)

clean:
	$(MAKE) clean -C $(SUBDIRSCBC)
	$(MAKE) clean -C $(SUBDIRSGLPK)
	
	